# 테스트 컨테이너 사용 가이드

## 개요
본 프로젝트는 **Testcontainers**를 사용하여 통합 테스트를 수행합니다.
Testcontainers는 실제 MySQL 데이터베이스를 Docker 컨테이너로 자동 실행하여 실제 환경과 유사한 조건에서 테스트를 진행합니다.

## 사전 준비사항

### 1. Docker 설치 필수
테스트 실행을 위해 **Docker Desktop**이 설치되어 있어야 합니다.

- **macOS**: [Docker Desktop for Mac](https://docs.docker.com/desktop/install/mac-install/)
- **Windows**: [Docker Desktop for Windows](https://docs.docker.com/desktop/install/windows-install/)
- **Linux**: [Docker Engine](https://docs.docker.com/engine/install/)

### 2. Docker 실행 확인
테스트 실행 전 Docker가 실행 중인지 확인하세요.

```bash
docker --version
docker ps
```

## 테스트 실행 방법

### 1. 전체 테스트 실행
```bash
./gradlew test
```

### 2. 통합 테스트만 실행
```bash
./gradlew test --tests "me.seyoung.ecomerce.integrationTest.*"
```

### 3. 특정 통합 테스트 실행
```bash
# 포인트 통합 테스트
./gradlew test --tests "me.seyoung.ecomerce.integrationTest.point.PointIntegrationTest"

# 쿠폰 통합 테스트
./gradlew test --tests "me.seyoung.ecomerce.integrationTest.coupon.*"
```

## 테스트 구조

### 통합 테스트 위치
```
src/test/java/me/seyoung/ecomerce/integrationTest/
├── AbstractContainerBaseTest.java  # 테스트 컨테이너 기본 설정
├── point/
│   └── PointIntegrationTest.java   # 포인트 통합 테스트
└── coupon/
    └── ...                          # 쿠폰 통합 테스트
```

### 통합 테스트 특징
- **실제 MySQL 8.3.0** 컨테이너 사용
- 테스트 실행 시 자동으로 컨테이너 생성 및 종료
- `@Transactional`을 사용하여 각 테스트 후 데이터 롤백
- 컨테이너 재사용으로 테스트 성능 향상

## 주의사항

### 1. Docker 미실행 시 에러
Docker가 실행되지 않은 상태에서 테스트를 실행하면 다음과 같은 에러가 발생합니다:
```
Could not find a valid Docker environment.
```
**해결방법**: Docker Desktop을 실행한 후 다시 테스트를 실행하세요.

### 2. 첫 실행 시 시간 소요
최초 테스트 실행 시 MySQL 이미지를 다운로드하므로 시간이 다소 걸릴 수 있습니다.
```
Pulling image: mysql:8.3.0
```

### 3. 포트 충돌
로컬에서 MySQL이 실행 중이어도 문제없습니다. Testcontainers는 임의의 포트를 사용합니다.

## 테스트 확인

### 성공적인 테스트 실행
```
BUILD SUCCESSFUL in 18s
```

### 테스트 결과 확인
```
build/reports/tests/test/index.html
```
위 파일을 브라우저로 열어 상세한 테스트 결과를 확인할 수 있습니다.

## 문제 해결

### Docker 관련 문제
1. Docker Desktop 재시작
2. Docker 이미지 초기화
   ```bash
   docker system prune -a
   ```

### 테스트 실패 시
1. 테스트 리포트 확인: `build/reports/tests/test/index.html`
2. 로그 확인:
   ```bash
   ./gradlew test --info
   ```

## 참고 자료
- [Testcontainers 공식 문서](https://www.testcontainers.org/)
- [Spring Boot Testcontainers 가이드](https://spring.io/blog/2023/06/23/improved-testcontainers-support-in-spring-boot-3-1)
